//Server Imports
#include <BLEDevice.h>
#include <BLEUtils.h>
#include <BLEServer.h>
#include "Arduino.h"
#include <FastLED.h>

//Service and Characteristic IDs
#define SERVICE_UUID        "4fafc201-1fb5-459e-8fcc-c5c9c331914b"
#define CHARACTERISTIC_UUID "beb5483e-36e1-4688-b7f5-ea07361b26a8"

//LED Macros
#define LED_PIN 9
#define NUM_LEDS 64
#define BRIGHTNESS 50  
#define BLINKER_SPEED 75

BLECharacteristic *pCharacteristic = nullptr; // Global declaration

//Event Callbacks to never stop advertising 
class MyServerCallbacks: public BLEServerCallbacks {
    void onConnect(BLEServer* pServer) {
      Serial.println("Device connected");
    }

    void onDisconnect(BLEServer* pServer) {
      Serial.println("Device disconnected");
      BLEDevice::startAdvertising(); // Restart advertising
      Serial.println("Advertising started...");
    }
};

CRGB leds[NUM_LEDS];

void setup() {
  //Set baudrate 
  Serial.begin(115200);
  Serial.println("Starting BLE work!");

  //Setup Bluetooth
  //Init Server
  BLEDevice::init("XIAO_ESP32S3");
  BLEServer *pServer = BLEDevice::createServer();
  //Init Callback
  pServer->setCallbacks(new MyServerCallbacks());
  //Init Service
  BLEService *pService = pServer->createService(SERVICE_UUID);
  //Init Characteristic
  pCharacteristic = pService->createCharacteristic(
                                         CHARACTERISTIC_UUID,
                                         BLECharacteristic::PROPERTY_READ |
                                         BLECharacteristic::PROPERTY_WRITE
                                       );
  pCharacteristic->setValue("Hello World");
  //Init Advertising
  pService->start();
  // BLEAdvertising *pAdvertising = pServer->getAdvertising();  // this still is working for backward compatibility
  BLEAdvertising *pAdvertising = BLEDevice::getAdvertising();
  pAdvertising->addServiceUUID(SERVICE_UUID);
  pAdvertising->setScanResponse(true);
  pAdvertising->setMinPreferred(0x06);  // functions that help with iPhone connections issue
  pAdvertising->setMinPreferred(0x12);
  BLEDevice::startAdvertising();
  Serial.println("Characteristic defined! Now you can read it in your phone!");

  //Setup LED
  //Init 
  FastLED.addLeds<WS2812, LED_PIN, GRB>(leds, NUM_LEDS);
  FastLED.setBrightness(BRIGHTNESS);
}

void displayFrame(const long frame[]) {
  FastLED.clear();
  for(int i = 0; i < NUM_LEDS; i++) {
    leds[i] = pgm_read_dword(&(frame[i]));  // Read array from Flash
  }
  FastLED.show();
  delay(BLINKER_SPEED);
}

const long ParkAnimation_Frame1[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
};

const long ParkAnimation_Frame2[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x4b0000, 0x000000, 0x000000, 0x4b0000, 0x000000, 0x000000,
0x000000, 0x000000, 0x4b0000, 0x000000, 0x000000, 0x4b0000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
};

const long ParkAnimation_Frame3[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 
0x000000, 0x4b0000, 0x000000, 0x000000, 0x000000, 0x000000, 0x4b0000, 0x000000, 
0x000000, 0x4b0000, 0x000000, 0x000000, 0x000000, 0x000000, 0x4b0000, 0x000000,
0x000000, 0x4b0000, 0x000000, 0x000000, 0x000000, 0x000000, 0x4b0000, 0x000000, 
0x000000, 0x4b0000, 0x000000, 0x000000, 0x000000, 0x000000, 0x4b0000, 0x000000, 
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
};

const long ParkAnimation_Frame4[] PROGMEM =
{
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000,  
0x000000, 0x4b0000, 0x000000, 0x000000, 0x000000, 0x000000, 0x4b0000, 0x000000,
0x4b0000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x4b0000,
0x4b0000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x4b0000,
0x4b0000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x4b0000,
0x4b0000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x4b0000, 
0x000000, 0x4b0000, 0x000000, 0x000000, 0x000000, 0x000000, 0x4b0000, 0x000000,
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000,
};

const long ParkAnimation_Frame5[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xff0000, 0xff0000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000,
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xff0000, 0xff0000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
};

const long ParkAnimation_Frame6[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, 
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000,
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
};

const long ParkAnimation_Frame7[] PROGMEM =
{
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, 
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000,  
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000,
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, 
};

const long ParkAnimation_Frame8[] PROGMEM =
{
0x000000, 0x000000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0x000000, 0x000000, 
0x000000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0x000000, 
0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 
0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 
0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000,  
0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 
0x000000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0x000000,
0x000000, 0x000000, 0xc80000, 0xc80000, 0xc80000, 0xc80000, 0x000000, 0x000000,
};

const long ParkAnimation_Frame9[] PROGMEM =
{
0x000000, 0x000000, 0x960000, 0x960000, 0x960000, 0x960000, 0x000000, 0x000000, 
0x000000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x000000, 
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000,  
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 
0x000000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x000000,
0x000000, 0x000000, 0x960000, 0x960000, 0x960000, 0x960000, 0x000000, 0x000000,
};

const long ParkAnimation_Frame10[] PROGMEM =
{
0x000000, 0x000000, 0x640000, 0x640000, 0x640000, 0x640000, 0x000000, 0x000000, 
0x000000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x000000, 
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000,  
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 
0x000000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x000000,
0x000000, 0x000000, 0x640000, 0x640000, 0x640000, 0x640000, 0x000000, 0x000000,
};

const long LeftArrow_Frame1[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
};

const long LeftArrow_Frame2[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
};

const long LeftArrow_Frame3[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000,
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,  
};

const long LeftArrow_Frame4[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,  
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,
0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 
};

const long LeftArrow_Frame5[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,
0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 
0xffa500, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0xffa500, 
};

const long LeftArrow_Frame6[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,
0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 
0xffa500, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0xffa500, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000,
};

const long LeftArrow_Frame7[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,
0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 
0xffa500, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0xffa500, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
};

const long LeftArrow_Frame8[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,
0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 
0xffa500, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0xffa500, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
};

const long RightArrow_Frame1[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000,  
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
};

const long RightArrow_Frame2[] PROGMEM =
{
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
};

const long RightArrow_Frame3[] PROGMEM =
{
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
};

const long RightArrow_Frame4[] PROGMEM =
{
0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,  
};

const long RightArrow_Frame5[] PROGMEM =
{
0xffa500, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0xffa500, 
0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
};

const long RightArrow_Frame6[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000,
0xffa500, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0xffa500, 
0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
};

const long RightArrow_Frame7[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000,
0xffa500, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0xffa500, 
0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
};

const long RightArrow_Frame8[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000,  
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000,
0xffa500, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0xffa500, 
0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 0x000000, 0xffa500, 0xffa500, 
0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000,
0x000000, 0x000000, 0xffa500, 0xffa500, 0xffa500, 0xffa500, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0xffa500, 0xffa500, 0x000000, 0x000000, 0x000000, 
};

const long Hazard_Frame1[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
};

const long Hazard_Frame2[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000,
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
};

const long Hazard_Frame3[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 
0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 
0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000,
0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 
0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
};

const long Hazard_Frame4[] PROGMEM =
{
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 
0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 
0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 
0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 
0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000,  
0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 
0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000,
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000,
};


const long Brake[] PROGMEM =
{
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, 
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000,  
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000,  
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000,  
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, 
};

const long Park[] PROGMEM =
{
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 
0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000,  
0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 
0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000,  
0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 
0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000,  
0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 
0x000000, 0x000000, 0x4b0000, 0x4b0000, 0x4b0000, 0x4b0000, 0x000000, 0x000000, 
};

const long ReverseLight[] PROGMEM =
{
0x000000, 0x000000, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0x000000, 0x000000, 
0x000000, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0x000000,  
0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 
0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff,  
0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff,  
0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 
0x000000, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0x000000,
0x000000, 0x000000, 0xffffff, 0xffffff, 0xffffff, 0xffffff, 0x000000, 0x000000,
};

const long Blank[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000,
};

const long VIP_Red[] PROGMEM =
{
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, 
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000,  
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000,  
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000,  
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, 
};

const long VIP_Blue[] PROGMEM =
{
0x000000, 0x000000, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x000000, 0x000000, 
0x000000, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x000000,  
0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 
0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff,  
0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 
0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff,  
0x000000, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x000000, 
0x000000, 0x000000, 0x0000ff, 0x0000ff, 0x0000ff, 0x0000ff, 0x000000, 0x000000, 
};

const long KnightRider_Frame1[] PROGMEM =
{
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, //7
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, //6
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, //5
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, //4
0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, //3
0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, //2
0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, //1
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
};

const long KnightRider_Frame2[] PROGMEM =
{
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, //6
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, //7
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, //4
0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, //3
0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, //2
0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, //1
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
};

const long KnightRider_Frame3[] PROGMEM =
{
0x000000, 0x000000, 0x960000, 0x960000, 0x960000, 0x960000, 0x000000, 0x000000, //5
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, //6
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //7
0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, //2
0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, //1
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
};

const long KnightRider_Frame4[] PROGMEM =
{
0x000000, 0x000000, 0x640000, 0x640000, 0x640000, 0x640000, 0x000000, 0x000000, //4
0x000000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x000000, //5
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //6
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //7
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
};

const long KnightRider_Frame5[] PROGMEM =
{
0x000000, 0x000000, 0x320000, 0x320000, 0x320000, 0x320000, 0x000000, 0x000000, //3
0x000000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x000000, //4
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, //5
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //6
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //7
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
};

const long KnightRider_Frame6[] PROGMEM =
{
0x000000, 0x000000, 0x140000, 0x140000, 0x140000, 0x140000, 0x000000, 0x000000, //2
0x000000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x000000, //3
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, //4
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, //5
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //6
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //7
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
};

const long KnightRider_Frame7[] PROGMEM =
{
0x000000, 0x000000, 0x050000, 0x050000, 0x050000, 0x050000, 0x000000, 0x000000, //1
0x000000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x000000, //2
0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, //3
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, //4
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, //5
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //6
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, //7
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
};

const long KnightRider_Frame8[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x000000, //1
0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, //2
0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, //3
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, //4
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, //5
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, //6
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, //7
};

const long KnightRider_Frame9[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, //1
0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, //2
0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, //3
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, //4
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, //7
0x000000, 0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, 0x000000, //6
};

const long KnightRider_Frame10[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, 0x050000, //1
0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, //2
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //7
0x000000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0x000000, //6
0x000000, 0x000000, 0x960000, 0x960000, 0x960000, 0x960000, 0x000000, 0x000000, //5
};

const long KnightRider_Frame11[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //7
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //6
0x000000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x000000, //5
0x000000, 0x000000, 0x640000, 0x640000, 0x640000, 0x640000, 0x000000, 0x000000, //4
};

const long KnightRider_Frame12[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //7
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //6
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, //5
0x000000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x000000, //4
0x000000, 0x000000, 0x320000, 0x320000, 0x320000, 0x320000, 0x000000, 0x000000, //3
};

const long KnightRider_Frame13[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //7
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //6
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, //5
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, //4
0x000000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x000000, //3
0x000000, 0x000000, 0x140000, 0x140000, 0x140000, 0x140000, 0x000000, 0x000000, //2
};

const long KnightRider_Frame14[] PROGMEM =
{
0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, //0
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //7
0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, 0xff0000, //6
0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, 0x960000, //5
0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, 0x640000, //4
0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, 0x320000, //3
0x000000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x140000, 0x000000, //2
0x000000, 0x000000, 0x050000, 0x050000, 0x050000, 0x050000, 0x000000, 0x000000, //1
};

const long a = 0x4b0000;
const long _ = 0x000000;
// const long RightDownArrow[] PROGMEM =
// {
// a, a, _, _, _, _, a, a, //0 flip
// a, a, _, _, _, a, a, _, //1
// a, a, _, _, a, a, _, _, //2 flip
// a, a, _, a, a, _, _, _, //3
// a, a, a, a, _, _, _, _, //4 flip
// a, a, a, _, _, _, _, _, //5
// a, a, a, a, a, a, a, a, //6 flip
// a, a, a, a, a, a, a, a, //7
// };

// const long RightDownArrow1[] PROGMEM =
// {
// a, a, _, _, _, _, _, a, //0
// a, a, _, _, _, _, a, _, //1
// a, a, _, _, _, a, _, _, //2
// a, a, _, _, a, _, _, _, //3
// a, a, _, a, _, _, _, _, //4
// a, a, a, _, _, _, _, _, //5
// a, a, a, a, a, a, a, a, //6
// a, a, a, a, a, a, a, a, //7
// };

// const long RightDownArrow2[] PROGMEM =
// {
// a, a, _, _, _, _, _, a, //0
// a, a, _, _, _, _, a, a, //1
// a, a, _, _, _, a, a, _, //2
// a, a, _, _, a, a, _, _, //3
// a, a, _, a, a, _, _, _, //4
// a, a, a, a, _, _, _, _, //5
// a, a, a, a, a, a, a, a, //6
// a, a, a, a, a, a, a, a, //7
// };

const long RightDownArrow[] PROGMEM =
{
a, a, _, _, _, _, a, a, //0
a, a, _, _, _, a, a, a, //1
a, a, _, _, a, a, a, _, //2
a, a, _, a, a, a, _, _, //3
a, a, a, a, a, _, _, _, //4
a, a, a, a, _, _, _, _, //5
a, a, a, a, a, a, a, a, //6
a, a, a, a, a, a, a, a, //7
};

const long LeftDownArrow[] PROGMEM =
{
a, a, a, a, a, a, a, a, //0
a, a, a, a, a, a, a, a, //1
a, a, a, a, _, _, _, _, //2
a, a, a, a, a, _, _, _, //3
a, a, _, a, a, a, _, _, //4
a, a, _, _, a, a, a, _, //5
a, a, _, _, _, a, a, a, //6 flip
a, a, _, _, _, _, a, a, //7
};

long* flipEvenRows(const long frame[]) {
  int rows = sqrt(NUM_LEDS);
  int cols = sqrt(NUM_LEDS);
  long* newFrame = new long[NUM_LEDS];
  for (int i = 0; i < NUM_LEDS; i++) {
    newFrame[i] = frame[i]; // Copy original frame to newFrame
  }
  for (int row = 0; row < rows; row += 2) { // Iterate over even rows
    for (int col = 0; col < cols; col++) { // Copy elements in the row in reverse order for even rows
      newFrame[row * cols + col] = frame[row * cols + (cols - 1 - col)];
    }
  }
  return newFrame;
}


const long* RightArrow_Frames[] PROGMEM = {
  RightArrow_Frame1,
  RightArrow_Frame2,
  RightArrow_Frame3,
  RightArrow_Frame4,
  RightArrow_Frame5,
  RightArrow_Frame6,
  RightArrow_Frame7,
  RightArrow_Frame8
};

const long* LeftArrow_Frames[] PROGMEM = {
  LeftArrow_Frame1,
  LeftArrow_Frame2,
  LeftArrow_Frame3,
  LeftArrow_Frame4,
  LeftArrow_Frame5,
  LeftArrow_Frame6,
  LeftArrow_Frame7,
  LeftArrow_Frame8
};

const long* KnightRider_Frames[] PROGMEM = {
  KnightRider_Frame1,
  KnightRider_Frame2,
  KnightRider_Frame3,
  KnightRider_Frame4,
  KnightRider_Frame5,
  KnightRider_Frame6,
  KnightRider_Frame7,
  KnightRider_Frame8,
  KnightRider_Frame9,
  KnightRider_Frame10,
  KnightRider_Frame11,
  KnightRider_Frame12,
  KnightRider_Frame13,
  KnightRider_Frame14
};

const long* ParkAnimation_Frames[] PROGMEM = {
  ParkAnimation_Frame1,
  ParkAnimation_Frame2,
  ParkAnimation_Frame3,
  ParkAnimation_Frame4
};

const long* Hazard_Frames[] PROGMEM = {
  Hazard_Frame1,
  Hazard_Frame2,
  Hazard_Frame3,
  Hazard_Frame4
};


void runRightBlinker() {
  for(int frame = 0; frame < sizeof(RightArrow_Frames)/sizeof(RightArrow_Frames[0]); frame++) {
    displayFrame(RightArrow_Frames[frame]);
  }

  displayFrame(Blank);
}

void runLeftBlinker()
{
  for(int frame = 0; frame < sizeof(LeftArrow_Frames)/sizeof(LeftArrow_Frames[0]); frame++) {
    displayFrame(LeftArrow_Frames[frame]);
  }

  displayFrame(Blank);
}

void runParkAnimation()
{
  for(int frame = 0; frame < sizeof(ParkAnimation_Frames)/sizeof(ParkAnimation_Frames[0]); frame++) {
    displayFrame(ParkAnimation_Frames[frame]);
  }

  displayFrame(Blank);
}

void runHazardAnimation()
{
  for(int frame = 0; frame < sizeof(Hazard_Frames)/sizeof(Hazard_Frames[0]); frame++) {
    displayFrame(Hazard_Frames[frame]);
  }

  displayFrame(Blank);
}

void runKnightRider()
{
  for(int frame = 0; frame < sizeof(KnightRider_Frames)/sizeof(KnightRider_Frames[0]); frame++) {
    displayFrame(KnightRider_Frames[frame]);
  }

  displayFrame(Blank);
}

void loop() {
  // put your main code here, to run repeatedly:
  // delay(2000);

  if (pCharacteristic != nullptr) { // Check if pCharacteristic is initialized
    std::string value = pCharacteristic->getValue();
    String valueStr = String(value.c_str());

    if (valueStr == "right") {
      runRightBlinker(); 
    }

    else if (valueStr == "left") {
      runLeftBlinker(); 
    }

    else if (valueStr == "parkanim") {
      runParkAnimation(); //fix
    }

    else if (valueStr == "hazard") {
      runHazardAnimation(); 
    }

    else if (valueStr == "blue") {
      displayFrame(VIP_Blue); 
    }

    else if (valueStr == "red") {
      displayFrame(VIP_Red); 
    }

    else if (valueStr == "reverse") {
      displayFrame(ReverseLight); 
    }

    else if (valueStr == "park") {
      displayFrame(Park); 
    }

    else if (valueStr == "brake") {
      displayFrame(Brake); 
    }

    else if (valueStr == "knight") {
      runKnightRider();
    }

    else if (valueStr == "rightdown" || valueStr == "rd") {
      long* newFrame = flipEvenRows(RightDownArrow);
      displayFrame(newFrame); 
      displayFrame(Blank);
      displayFrame(newFrame); 
      delete[] newFrame;
    }

    else if (valueStr == "leftdown" || valueStr == "ld") {
      long* newFrame = flipEvenRows(LeftDownArrow);
      displayFrame(newFrame); 
      displayFrame(Blank);
      displayFrame(newFrame); 
      delete[] newFrame;
    }

    else{
      displayFrame(Blank);
    }


    
  }
}